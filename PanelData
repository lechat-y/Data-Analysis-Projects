{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 38,
   "id": "72b47d50",
   "metadata": {},
   "outputs": [
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "Requirement already satisfied: linearmodels in /opt/anaconda3/lib/python3.11/site-packages (6.1)\n",
      "Requirement already satisfied: numpy<3,>=1.22.3 in /opt/anaconda3/lib/python3.11/site-packages (from linearmodels) (1.26.4)\n",
      "Requirement already satisfied: pandas>=1.4.0 in /opt/anaconda3/lib/python3.11/site-packages (from linearmodels) (2.1.4)\n",
      "Requirement already satisfied: scipy>=1.8.0 in /opt/anaconda3/lib/python3.11/site-packages (from linearmodels) (1.11.4)\n",
      "Requirement already satisfied: statsmodels>=0.13.0 in /opt/anaconda3/lib/python3.11/site-packages (from linearmodels) (0.14.0)\n",
      "Requirement already satisfied: mypy-extensions>=0.4 in /opt/anaconda3/lib/python3.11/site-packages (from linearmodels) (1.0.0)\n",
      "Requirement already satisfied: Cython>=3.0.10 in /opt/anaconda3/lib/python3.11/site-packages (from linearmodels) (3.0.11)\n",
      "Requirement already satisfied: pyhdfe>=0.1 in /opt/anaconda3/lib/python3.11/site-packages (from linearmodels) (0.2.0)\n",
      "Requirement already satisfied: formulaic>=1.0.0 in /opt/anaconda3/lib/python3.11/site-packages (from linearmodels) (1.1.1)\n",
      "Requirement already satisfied: setuptools-scm<9.0.0,>=8.0.0 in /opt/anaconda3/lib/python3.11/site-packages (from setuptools-scm[toml]<9.0.0,>=8.0.0->linearmodels) (8.1.0)\n",
      "Requirement already satisfied: interface-meta>=1.2.0 in /opt/anaconda3/lib/python3.11/site-packages (from formulaic>=1.0.0->linearmodels) (1.3.0)\n",
      "Requirement already satisfied: typing-extensions>=4.2.0 in /opt/anaconda3/lib/python3.11/site-packages (from formulaic>=1.0.0->linearmodels) (4.9.0)\n",
      "Requirement already satisfied: wrapt>=1.0 in /opt/anaconda3/lib/python3.11/site-packages (from formulaic>=1.0.0->linearmodels) (1.14.1)\n",
      "Requirement already satisfied: python-dateutil>=2.8.2 in /opt/anaconda3/lib/python3.11/site-packages (from pandas>=1.4.0->linearmodels) (2.8.2)\n",
      "Requirement already satisfied: pytz>=2020.1 in /opt/anaconda3/lib/python3.11/site-packages (from pandas>=1.4.0->linearmodels) (2023.3.post1)\n",
      "Requirement already satisfied: tzdata>=2022.1 in /opt/anaconda3/lib/python3.11/site-packages (from pandas>=1.4.0->linearmodels) (2023.3)\n",
      "Requirement already satisfied: packaging>=20 in /opt/anaconda3/lib/python3.11/site-packages (from setuptools-scm<9.0.0,>=8.0.0->setuptools-scm[toml]<9.0.0,>=8.0.0->linearmodels) (23.1)\n",
      "Requirement already satisfied: setuptools in /opt/anaconda3/lib/python3.11/site-packages (from setuptools-scm<9.0.0,>=8.0.0->setuptools-scm[toml]<9.0.0,>=8.0.0->linearmodels) (68.2.2)\n",
      "Requirement already satisfied: patsy>=0.5.2 in /opt/anaconda3/lib/python3.11/site-packages (from statsmodels>=0.13.0->linearmodels) (0.5.3)\n",
      "Requirement already satisfied: six in /opt/anaconda3/lib/python3.11/site-packages (from patsy>=0.5.2->statsmodels>=0.13.0->linearmodels) (1.16.0)\n",
      "Note: you may need to restart the kernel to use updated packages.\n"
     ]
    }
   ],
   "source": [
    "pip install linearmodels"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 39,
   "id": "70455e32",
   "metadata": {},
   "outputs": [],
   "source": [
    "import pandas as pd\n",
    "import numpy as np\n",
    "import matplotlib.pyplot as plt\n",
    "import statsmodels.formula.api as sm\n",
    "import statsmodels.api as sm\n",
    "from linearmodels.panel import RandomEffects, BetweenOLS\n",
    "from scipy import stats"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 40,
   "id": "c64531d9",
   "metadata": {
    "scrolled": true
   },
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>county</th>\n",
       "      <th>year</th>\n",
       "      <th>crimerate</th>\n",
       "      <th>arrested</th>\n",
       "      <th>convicted</th>\n",
       "      <th>imprisoned</th>\n",
       "      <th>average_sentence</th>\n",
       "      <th>police_per_capita</th>\n",
       "      <th>population_density</th>\n",
       "      <th>taxes_per_capita</th>\n",
       "      <th>west</th>\n",
       "      <th>central</th>\n",
       "      <th>urban</th>\n",
       "      <th>nonwhite</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>1</td>\n",
       "      <td>81</td>\n",
       "      <td>0.040778</td>\n",
       "      <td>0.275455</td>\n",
       "      <td>0.406284</td>\n",
       "      <td>0.461732</td>\n",
       "      <td>5.330053</td>\n",
       "      <td>0.001804</td>\n",
       "      <td>2.270431</td>\n",
       "      <td>25.935743</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>20.218700</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>1</td>\n",
       "      <td>82</td>\n",
       "      <td>0.039485</td>\n",
       "      <td>0.331728</td>\n",
       "      <td>0.450913</td>\n",
       "      <td>0.529668</td>\n",
       "      <td>5.472677</td>\n",
       "      <td>0.001810</td>\n",
       "      <td>2.382773</td>\n",
       "      <td>24.618464</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>20.218700</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>1</td>\n",
       "      <td>83</td>\n",
       "      <td>0.031006</td>\n",
       "      <td>0.320215</td>\n",
       "      <td>0.537950</td>\n",
       "      <td>0.481605</td>\n",
       "      <td>5.674882</td>\n",
       "      <td>0.001864</td>\n",
       "      <td>2.229982</td>\n",
       "      <td>25.542921</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>20.218700</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>1</td>\n",
       "      <td>84</td>\n",
       "      <td>0.033894</td>\n",
       "      <td>0.354284</td>\n",
       "      <td>0.578941</td>\n",
       "      <td>0.510419</td>\n",
       "      <td>7.070176</td>\n",
       "      <td>0.001976</td>\n",
       "      <td>2.295385</td>\n",
       "      <td>25.852477</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>20.218700</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>1</td>\n",
       "      <td>85</td>\n",
       "      <td>0.038189</td>\n",
       "      <td>0.311906</td>\n",
       "      <td>0.589034</td>\n",
       "      <td>0.505421</td>\n",
       "      <td>6.798724</td>\n",
       "      <td>0.001905</td>\n",
       "      <td>2.466565</td>\n",
       "      <td>27.835152</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>20.218700</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>554</th>\n",
       "      <td>195</td>\n",
       "      <td>83</td>\n",
       "      <td>0.057464</td>\n",
       "      <td>0.240689</td>\n",
       "      <td>0.316291</td>\n",
       "      <td>0.460240</td>\n",
       "      <td>10.124740</td>\n",
       "      <td>0.001815</td>\n",
       "      <td>1.651091</td>\n",
       "      <td>27.639358</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>37.431099</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>555</th>\n",
       "      <td>195</td>\n",
       "      <td>84</td>\n",
       "      <td>0.054421</td>\n",
       "      <td>0.160075</td>\n",
       "      <td>0.326618</td>\n",
       "      <td>0.485832</td>\n",
       "      <td>11.145317</td>\n",
       "      <td>0.001882</td>\n",
       "      <td>1.718913</td>\n",
       "      <td>28.192146</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>37.431099</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>556</th>\n",
       "      <td>197</td>\n",
       "      <td>82</td>\n",
       "      <td>0.018123</td>\n",
       "      <td>0.231978</td>\n",
       "      <td>0.538608</td>\n",
       "      <td>0.352185</td>\n",
       "      <td>6.937614</td>\n",
       "      <td>0.000929</td>\n",
       "      <td>0.894356</td>\n",
       "      <td>17.233129</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>5.460810</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>557</th>\n",
       "      <td>197</td>\n",
       "      <td>83</td>\n",
       "      <td>0.015535</td>\n",
       "      <td>0.223711</td>\n",
       "      <td>0.470301</td>\n",
       "      <td>0.433362</td>\n",
       "      <td>7.456453</td>\n",
       "      <td>0.001050</td>\n",
       "      <td>0.881013</td>\n",
       "      <td>17.986530</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>5.460810</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>558</th>\n",
       "      <td>197</td>\n",
       "      <td>85</td>\n",
       "      <td>0.012888</td>\n",
       "      <td>0.172161</td>\n",
       "      <td>0.818581</td>\n",
       "      <td>0.318152</td>\n",
       "      <td>6.032874</td>\n",
       "      <td>0.001101</td>\n",
       "      <td>0.897487</td>\n",
       "      <td>25.247786</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>5.460810</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>559 rows × 14 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "     county  year  crimerate  arrested  convicted  imprisoned  \\\n",
       "0         1    81   0.040778  0.275455   0.406284    0.461732   \n",
       "1         1    82   0.039485  0.331728   0.450913    0.529668   \n",
       "2         1    83   0.031006  0.320215   0.537950    0.481605   \n",
       "3         1    84   0.033894  0.354284   0.578941    0.510419   \n",
       "4         1    85   0.038189  0.311906   0.589034    0.505421   \n",
       "..      ...   ...        ...       ...        ...         ...   \n",
       "554     195    83   0.057464  0.240689   0.316291    0.460240   \n",
       "555     195    84   0.054421  0.160075   0.326618    0.485832   \n",
       "556     197    82   0.018123  0.231978   0.538608    0.352185   \n",
       "557     197    83   0.015535  0.223711   0.470301    0.433362   \n",
       "558     197    85   0.012888  0.172161   0.818581    0.318152   \n",
       "\n",
       "     average_sentence  police_per_capita  population_density  \\\n",
       "0            5.330053           0.001804            2.270431   \n",
       "1            5.472677           0.001810            2.382773   \n",
       "2            5.674882           0.001864            2.229982   \n",
       "3            7.070176           0.001976            2.295385   \n",
       "4            6.798724           0.001905            2.466565   \n",
       "..                ...                ...                 ...   \n",
       "554         10.124740           0.001815            1.651091   \n",
       "555         11.145317           0.001882            1.718913   \n",
       "556          6.937614           0.000929            0.894356   \n",
       "557          7.456453           0.001050            0.881013   \n",
       "558          6.032874           0.001101            0.897487   \n",
       "\n",
       "     taxes_per_capita  west  central  urban   nonwhite  \n",
       "0           25.935743     0        1      0  20.218700  \n",
       "1           24.618464     0        1      0  20.218700  \n",
       "2           25.542921     0        1      0  20.218700  \n",
       "3           25.852477     0        1      0  20.218700  \n",
       "4           27.835152     0        1      0  20.218700  \n",
       "..                ...   ...      ...    ...        ...  \n",
       "554         27.639358     0        0      0  37.431099  \n",
       "555         28.192146     0        0      0  37.431099  \n",
       "556         17.233129     1        0      0   5.460810  \n",
       "557         17.986530     1        0      0   5.460810  \n",
       "558         25.247786     1        0      0   5.460810  \n",
       "\n",
       "[559 rows x 14 columns]"
      ]
     },
     "execution_count": 40,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df = pd.read_excel('25.xlsx') \n",
    "df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 43,
   "id": "2239f93b-3e5b-4277-9615-ff59d057ec72",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>county</th>\n",
       "      <th>сбалансирована</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>1</td>\n",
       "      <td>True</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>3</td>\n",
       "      <td>False</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>5</td>\n",
       "      <td>True</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>7</td>\n",
       "      <td>True</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>9</td>\n",
       "      <td>True</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>83</th>\n",
       "      <td>189</td>\n",
       "      <td>True</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>84</th>\n",
       "      <td>191</td>\n",
       "      <td>True</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>85</th>\n",
       "      <td>193</td>\n",
       "      <td>True</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>86</th>\n",
       "      <td>195</td>\n",
       "      <td>False</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>87</th>\n",
       "      <td>197</td>\n",
       "      <td>False</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>88 rows × 2 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "    county  сбалансирована\n",
       "0        1            True\n",
       "1        3           False\n",
       "2        5            True\n",
       "3        7            True\n",
       "4        9            True\n",
       "..     ...             ...\n",
       "83     189            True\n",
       "84     191            True\n",
       "85     193            True\n",
       "86     195           False\n",
       "87     197           False\n",
       "\n",
       "[88 rows x 2 columns]"
      ]
     },
     "execution_count": 43,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "new = df.groupby('county')['year'].apply(lambda x : len(x)==df['year'].nunique()).reset_index()\n",
    "new.rename(columns={'year':'сбалансирована'}, inplace=True)\n",
    "new"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 44,
   "id": "a2a75dfe-0db0-4632-88a6-5d22b3da3064",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th>county</th>\n",
       "      <th>сбалансирована</th>\n",
       "      <th>year</th>\n",
       "      <th>crimerate</th>\n",
       "      <th>arrested</th>\n",
       "      <th>convicted</th>\n",
       "      <th>imprisoned</th>\n",
       "      <th>average_sentence</th>\n",
       "      <th>police_per_capita</th>\n",
       "      <th>population_density</th>\n",
       "      <th>taxes_per_capita</th>\n",
       "      <th>west</th>\n",
       "      <th>central</th>\n",
       "      <th>urban</th>\n",
       "      <th>nonwhite</th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th>0</th>\n",
       "      <td>1</td>\n",
       "      <td>True</td>\n",
       "      <td>81</td>\n",
       "      <td>0.040778</td>\n",
       "      <td>0.275455</td>\n",
       "      <td>0.406284</td>\n",
       "      <td>0.461732</td>\n",
       "      <td>5.330053</td>\n",
       "      <td>0.001804</td>\n",
       "      <td>2.270431</td>\n",
       "      <td>25.935743</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>20.21870</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>1</th>\n",
       "      <td>1</td>\n",
       "      <td>True</td>\n",
       "      <td>82</td>\n",
       "      <td>0.039485</td>\n",
       "      <td>0.331728</td>\n",
       "      <td>0.450913</td>\n",
       "      <td>0.529668</td>\n",
       "      <td>5.472677</td>\n",
       "      <td>0.001810</td>\n",
       "      <td>2.382773</td>\n",
       "      <td>24.618464</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>20.21870</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>2</th>\n",
       "      <td>1</td>\n",
       "      <td>True</td>\n",
       "      <td>83</td>\n",
       "      <td>0.031006</td>\n",
       "      <td>0.320215</td>\n",
       "      <td>0.537950</td>\n",
       "      <td>0.481605</td>\n",
       "      <td>5.674882</td>\n",
       "      <td>0.001864</td>\n",
       "      <td>2.229982</td>\n",
       "      <td>25.542921</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>20.21870</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>3</th>\n",
       "      <td>1</td>\n",
       "      <td>True</td>\n",
       "      <td>84</td>\n",
       "      <td>0.033894</td>\n",
       "      <td>0.354284</td>\n",
       "      <td>0.578941</td>\n",
       "      <td>0.510419</td>\n",
       "      <td>7.070176</td>\n",
       "      <td>0.001976</td>\n",
       "      <td>2.295385</td>\n",
       "      <td>25.852477</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>20.21870</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>4</th>\n",
       "      <td>1</td>\n",
       "      <td>True</td>\n",
       "      <td>85</td>\n",
       "      <td>0.038189</td>\n",
       "      <td>0.311906</td>\n",
       "      <td>0.589034</td>\n",
       "      <td>0.505421</td>\n",
       "      <td>6.798724</td>\n",
       "      <td>0.001905</td>\n",
       "      <td>2.466565</td>\n",
       "      <td>27.835152</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>20.21870</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>547</th>\n",
       "      <td>193</td>\n",
       "      <td>True</td>\n",
       "      <td>83</td>\n",
       "      <td>0.021106</td>\n",
       "      <td>0.342442</td>\n",
       "      <td>0.320362</td>\n",
       "      <td>0.459907</td>\n",
       "      <td>7.555799</td>\n",
       "      <td>0.000962</td>\n",
       "      <td>0.812974</td>\n",
       "      <td>20.773625</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>5.93109</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>548</th>\n",
       "      <td>193</td>\n",
       "      <td>True</td>\n",
       "      <td>84</td>\n",
       "      <td>0.017887</td>\n",
       "      <td>0.354988</td>\n",
       "      <td>0.660164</td>\n",
       "      <td>0.455626</td>\n",
       "      <td>8.012051</td>\n",
       "      <td>0.000931</td>\n",
       "      <td>0.785233</td>\n",
       "      <td>23.073189</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>5.93109</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>549</th>\n",
       "      <td>193</td>\n",
       "      <td>True</td>\n",
       "      <td>85</td>\n",
       "      <td>0.017734</td>\n",
       "      <td>0.343921</td>\n",
       "      <td>0.557462</td>\n",
       "      <td>0.371822</td>\n",
       "      <td>7.957028</td>\n",
       "      <td>0.001013</td>\n",
       "      <td>0.820400</td>\n",
       "      <td>24.331742</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>5.93109</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>550</th>\n",
       "      <td>193</td>\n",
       "      <td>True</td>\n",
       "      <td>86</td>\n",
       "      <td>0.019687</td>\n",
       "      <td>0.333722</td>\n",
       "      <td>0.505929</td>\n",
       "      <td>0.393136</td>\n",
       "      <td>5.923151</td>\n",
       "      <td>0.001247</td>\n",
       "      <td>0.812980</td>\n",
       "      <td>26.082463</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>5.93109</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>551</th>\n",
       "      <td>193</td>\n",
       "      <td>True</td>\n",
       "      <td>87</td>\n",
       "      <td>0.024451</td>\n",
       "      <td>0.276074</td>\n",
       "      <td>0.604907</td>\n",
       "      <td>0.441725</td>\n",
       "      <td>6.020853</td>\n",
       "      <td>0.001175</td>\n",
       "      <td>0.846549</td>\n",
       "      <td>27.471642</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>5.93109</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>462 rows × 15 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "     county  сбалансирована  year  crimerate  arrested  convicted  imprisoned  \\\n",
       "0         1            True    81   0.040778  0.275455   0.406284    0.461732   \n",
       "1         1            True    82   0.039485  0.331728   0.450913    0.529668   \n",
       "2         1            True    83   0.031006  0.320215   0.537950    0.481605   \n",
       "3         1            True    84   0.033894  0.354284   0.578941    0.510419   \n",
       "4         1            True    85   0.038189  0.311906   0.589034    0.505421   \n",
       "..      ...             ...   ...        ...       ...        ...         ...   \n",
       "547     193            True    83   0.021106  0.342442   0.320362    0.459907   \n",
       "548     193            True    84   0.017887  0.354988   0.660164    0.455626   \n",
       "549     193            True    85   0.017734  0.343921   0.557462    0.371822   \n",
       "550     193            True    86   0.019687  0.333722   0.505929    0.393136   \n",
       "551     193            True    87   0.024451  0.276074   0.604907    0.441725   \n",
       "\n",
       "     average_sentence  police_per_capita  population_density  \\\n",
       "0            5.330053           0.001804            2.270431   \n",
       "1            5.472677           0.001810            2.382773   \n",
       "2            5.674882           0.001864            2.229982   \n",
       "3            7.070176           0.001976            2.295385   \n",
       "4            6.798724           0.001905            2.466565   \n",
       "..                ...                ...                 ...   \n",
       "547          7.555799           0.000962            0.812974   \n",
       "548          8.012051           0.000931            0.785233   \n",
       "549          7.957028           0.001013            0.820400   \n",
       "550          5.923151           0.001247            0.812980   \n",
       "551          6.020853           0.001175            0.846549   \n",
       "\n",
       "     taxes_per_capita  west  central  urban  nonwhite  \n",
       "0           25.935743     0        1      0  20.21870  \n",
       "1           24.618464     0        1      0  20.21870  \n",
       "2           25.542921     0        1      0  20.21870  \n",
       "3           25.852477     0        1      0  20.21870  \n",
       "4           27.835152     0        1      0  20.21870  \n",
       "..                ...   ...      ...    ...       ...  \n",
       "547         20.773625     1        0      0   5.93109  \n",
       "548         23.073189     1        0      0   5.93109  \n",
       "549         24.331742     1        0      0   5.93109  \n",
       "550         26.082463     1        0      0   5.93109  \n",
       "551         27.471642     1        0      0   5.93109  \n",
       "\n",
       "[462 rows x 15 columns]"
      ]
     },
     "execution_count": 44,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df_new = pd.merge(new, df, how='left', on='county')\n",
    "df_new = df_new[df_new['сбалансирована']==True]\n",
    "df_new"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 27,
   "id": "a15400f3-163a-47f2-ba1e-95bd752109eb",
   "metadata": {},
   "outputs": [],
   "source": [
    "df = df.set_index(['county', 'year'])\n",
    "\n",
    "y = df['crimerate']\n",
    "X = df[['arrested', 'convicted', 'imprisoned', 'average_sentence', 'police_per_capita',\n",
    "          'population_density', 'taxes_per_capita', 'west', 'central', 'urban', 'nonwhite']]\n",
    "X = sm.add_constant(X)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 28,
   "id": "c831c3ab-e2d2-40a9-8dd3-9b133ff4a91d",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<div>\n",
       "<style scoped>\n",
       "    .dataframe tbody tr th:only-of-type {\n",
       "        vertical-align: middle;\n",
       "    }\n",
       "\n",
       "    .dataframe tbody tr th {\n",
       "        vertical-align: top;\n",
       "    }\n",
       "\n",
       "    .dataframe thead th {\n",
       "        text-align: right;\n",
       "    }\n",
       "</style>\n",
       "<table border=\"1\" class=\"dataframe\">\n",
       "  <thead>\n",
       "    <tr style=\"text-align: right;\">\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th>crimerate</th>\n",
       "      <th>arrested</th>\n",
       "      <th>convicted</th>\n",
       "      <th>imprisoned</th>\n",
       "      <th>average_sentence</th>\n",
       "      <th>police_per_capita</th>\n",
       "      <th>population_density</th>\n",
       "      <th>taxes_per_capita</th>\n",
       "      <th>west</th>\n",
       "      <th>central</th>\n",
       "      <th>urban</th>\n",
       "      <th>nonwhite</th>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>county</th>\n",
       "      <th>year</th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "      <th></th>\n",
       "    </tr>\n",
       "  </thead>\n",
       "  <tbody>\n",
       "    <tr>\n",
       "      <th rowspan=\"5\" valign=\"top\">1</th>\n",
       "      <th>81</th>\n",
       "      <td>0.040778</td>\n",
       "      <td>0.275455</td>\n",
       "      <td>0.406284</td>\n",
       "      <td>0.461732</td>\n",
       "      <td>5.330053</td>\n",
       "      <td>0.001804</td>\n",
       "      <td>2.270431</td>\n",
       "      <td>25.935743</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>20.218700</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>82</th>\n",
       "      <td>0.039485</td>\n",
       "      <td>0.331728</td>\n",
       "      <td>0.450913</td>\n",
       "      <td>0.529668</td>\n",
       "      <td>5.472677</td>\n",
       "      <td>0.001810</td>\n",
       "      <td>2.382773</td>\n",
       "      <td>24.618464</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>20.218700</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>83</th>\n",
       "      <td>0.031006</td>\n",
       "      <td>0.320215</td>\n",
       "      <td>0.537950</td>\n",
       "      <td>0.481605</td>\n",
       "      <td>5.674882</td>\n",
       "      <td>0.001864</td>\n",
       "      <td>2.229982</td>\n",
       "      <td>25.542921</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>20.218700</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>84</th>\n",
       "      <td>0.033894</td>\n",
       "      <td>0.354284</td>\n",
       "      <td>0.578941</td>\n",
       "      <td>0.510419</td>\n",
       "      <td>7.070176</td>\n",
       "      <td>0.001976</td>\n",
       "      <td>2.295385</td>\n",
       "      <td>25.852477</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>20.218700</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>85</th>\n",
       "      <td>0.038189</td>\n",
       "      <td>0.311906</td>\n",
       "      <td>0.589034</td>\n",
       "      <td>0.505421</td>\n",
       "      <td>6.798724</td>\n",
       "      <td>0.001905</td>\n",
       "      <td>2.466565</td>\n",
       "      <td>27.835152</td>\n",
       "      <td>0</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>20.218700</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>...</th>\n",
       "      <th>...</th>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "      <td>...</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th rowspan=\"2\" valign=\"top\">195</th>\n",
       "      <th>83</th>\n",
       "      <td>0.057464</td>\n",
       "      <td>0.240689</td>\n",
       "      <td>0.316291</td>\n",
       "      <td>0.460240</td>\n",
       "      <td>10.124740</td>\n",
       "      <td>0.001815</td>\n",
       "      <td>1.651091</td>\n",
       "      <td>27.639358</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>37.431099</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>84</th>\n",
       "      <td>0.054421</td>\n",
       "      <td>0.160075</td>\n",
       "      <td>0.326618</td>\n",
       "      <td>0.485832</td>\n",
       "      <td>11.145317</td>\n",
       "      <td>0.001882</td>\n",
       "      <td>1.718913</td>\n",
       "      <td>28.192146</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>37.431099</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th rowspan=\"3\" valign=\"top\">197</th>\n",
       "      <th>82</th>\n",
       "      <td>0.018123</td>\n",
       "      <td>0.231978</td>\n",
       "      <td>0.538608</td>\n",
       "      <td>0.352185</td>\n",
       "      <td>6.937614</td>\n",
       "      <td>0.000929</td>\n",
       "      <td>0.894356</td>\n",
       "      <td>17.233129</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>5.460810</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>83</th>\n",
       "      <td>0.015535</td>\n",
       "      <td>0.223711</td>\n",
       "      <td>0.470301</td>\n",
       "      <td>0.433362</td>\n",
       "      <td>7.456453</td>\n",
       "      <td>0.001050</td>\n",
       "      <td>0.881013</td>\n",
       "      <td>17.986530</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>5.460810</td>\n",
       "    </tr>\n",
       "    <tr>\n",
       "      <th>85</th>\n",
       "      <td>0.012888</td>\n",
       "      <td>0.172161</td>\n",
       "      <td>0.818581</td>\n",
       "      <td>0.318152</td>\n",
       "      <td>6.032874</td>\n",
       "      <td>0.001101</td>\n",
       "      <td>0.897487</td>\n",
       "      <td>25.247786</td>\n",
       "      <td>1</td>\n",
       "      <td>0</td>\n",
       "      <td>0</td>\n",
       "      <td>5.460810</td>\n",
       "    </tr>\n",
       "  </tbody>\n",
       "</table>\n",
       "<p>559 rows × 12 columns</p>\n",
       "</div>"
      ],
      "text/plain": [
       "             crimerate  arrested  convicted  imprisoned  average_sentence  \\\n",
       "county year                                                                 \n",
       "1      81     0.040778  0.275455   0.406284    0.461732          5.330053   \n",
       "       82     0.039485  0.331728   0.450913    0.529668          5.472677   \n",
       "       83     0.031006  0.320215   0.537950    0.481605          5.674882   \n",
       "       84     0.033894  0.354284   0.578941    0.510419          7.070176   \n",
       "       85     0.038189  0.311906   0.589034    0.505421          6.798724   \n",
       "...                ...       ...        ...         ...               ...   \n",
       "195    83     0.057464  0.240689   0.316291    0.460240         10.124740   \n",
       "       84     0.054421  0.160075   0.326618    0.485832         11.145317   \n",
       "197    82     0.018123  0.231978   0.538608    0.352185          6.937614   \n",
       "       83     0.015535  0.223711   0.470301    0.433362          7.456453   \n",
       "       85     0.012888  0.172161   0.818581    0.318152          6.032874   \n",
       "\n",
       "             police_per_capita  population_density  taxes_per_capita  west  \\\n",
       "county year                                                                  \n",
       "1      81             0.001804            2.270431         25.935743     0   \n",
       "       82             0.001810            2.382773         24.618464     0   \n",
       "       83             0.001864            2.229982         25.542921     0   \n",
       "       84             0.001976            2.295385         25.852477     0   \n",
       "       85             0.001905            2.466565         27.835152     0   \n",
       "...                        ...                 ...               ...   ...   \n",
       "195    83             0.001815            1.651091         27.639358     0   \n",
       "       84             0.001882            1.718913         28.192146     0   \n",
       "197    82             0.000929            0.894356         17.233129     1   \n",
       "       83             0.001050            0.881013         17.986530     1   \n",
       "       85             0.001101            0.897487         25.247786     1   \n",
       "\n",
       "             central  urban   nonwhite  \n",
       "county year                             \n",
       "1      81          1      0  20.218700  \n",
       "       82          1      0  20.218700  \n",
       "       83          1      0  20.218700  \n",
       "       84          1      0  20.218700  \n",
       "       85          1      0  20.218700  \n",
       "...              ...    ...        ...  \n",
       "195    83          0      0  37.431099  \n",
       "       84          0      0  37.431099  \n",
       "197    82          0      0   5.460810  \n",
       "       83          0      0   5.460810  \n",
       "       85          0      0   5.460810  \n",
       "\n",
       "[559 rows x 12 columns]"
      ]
     },
     "execution_count": 28,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "df"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 29,
   "id": "e67d6e5d",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<table class=\"simpletable\">\n",
       "<caption>BetweenOLS Estimation Summary</caption>\n",
       "<tr>\n",
       "  <th>Dep. Variable:</th>        <td>crimerate</td>    <th>  R-squared:         </th>    <td>0.8707</td> \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Estimator:</th>           <td>BetweenOLS</td>    <th>  R-squared (Between):</th>   <td>0.8707</td> \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>No. Observations:</th>        <td>88</td>        <th>  R-squared (Within):</th>    <td>-0.8240</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Date:</th>             <td>Fri, Jan 17 2025</td> <th>  R-squared (Overall):</th>   <td>0.7746</td> \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Time:</th>                 <td>19:06:15</td>     <th>  Log-likelihood     </th>    <td>327.29</td> \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Cov. Estimator:</th>      <td>Unadjusted</td>    <th>                     </th>       <td></td>    \n",
       "</tr>\n",
       "<tr>\n",
       "  <th></th>                          <td></td>         <th>  F-statistic:       </th>    <td>46.536</td> \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Entities:</th>                <td>88</td>        <th>  P-value            </th>    <td>0.0000</td> \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Avg Obs:</th>               <td>6.3523</td>      <th>  Distribution:      </th>   <td>F(11,76)</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Min Obs:</th>               <td>1.0000</td>      <th>                     </th>       <td></td>    \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Max Obs:</th>               <td>7.0000</td>      <th>  F-statistic (robust):</th>  <td>46.536</td> \n",
       "</tr>\n",
       "<tr>\n",
       "  <th></th>                          <td></td>         <th>  P-value            </th>    <td>0.0000</td> \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Time periods:</th>             <td>7</td>        <th>  Distribution:      </th>   <td>F(11,76)</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Avg Obs:</th>               <td>79.857</td>      <th>                     </th>       <td></td>    \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Min Obs:</th>               <td>76.000</td>      <th>                     </th>       <td></td>    \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Max Obs:</th>               <td>84.000</td>      <th>                     </th>       <td></td>    \n",
       "</tr>\n",
       "<tr>\n",
       "  <th></th>                          <td></td>         <th>                     </th>       <td></td>    \n",
       "</tr>\n",
       "</table>\n",
       "<table class=\"simpletable\">\n",
       "<caption>Parameter Estimates</caption>\n",
       "<tr>\n",
       "           <td></td>          <th>Parameter</th> <th>Std. Err.</th> <th>T-stat</th>  <th>P-value</th> <th>Lower CI</th>  <th>Upper CI</th>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>const</th>               <td>0.0417</td>    <td>0.0104</td>   <td>4.0093</td>  <td>0.0001</td>   <td>0.0210</td>    <td>0.0624</td> \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>arrested</th>            <td>-0.0652</td>   <td>0.0090</td>   <td>-7.2223</td> <td>0.0000</td>   <td>-0.0831</td>   <td>-0.0472</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>convicted</th>           <td>-0.0390</td>   <td>0.0059</td>   <td>-6.6007</td> <td>0.0000</td>   <td>-0.0507</td>   <td>-0.0272</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>imprisoned</th>          <td>0.0221</td>    <td>0.0143</td>   <td>1.5460</td>  <td>0.1263</td>   <td>-0.0064</td>   <td>0.0505</td> \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>average_sentence</th>    <td>-0.0004</td>   <td>0.0005</td>   <td>-0.7510</td> <td>0.4550</td>   <td>-0.0014</td>   <td>0.0007</td> \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>police_per_capita</th>   <td>3.1896</td>    <td>1.5684</td>   <td>2.0336</td>  <td>0.0455</td>   <td>0.0658</td>    <td>6.3134</td> \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>population_density</th>  <td>0.0055</td>    <td>0.0010</td>   <td>5.2565</td>  <td>0.0000</td>   <td>0.0034</td>    <td>0.0076</td> \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>taxes_per_capita</th>    <td>0.0002</td>    <td>0.0001</td>   <td>2.0763</td>  <td>0.0413</td>  <td>8.77e-06</td>   <td>0.0004</td> \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>west</th>                <td>-0.0046</td>   <td>0.0030</td>   <td>-1.5643</td> <td>0.1219</td>   <td>-0.0105</td>   <td>0.0013</td> \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>central</th>             <td>-0.0028</td>   <td>0.0020</td>   <td>-1.4310</td> <td>0.1565</td>   <td>-0.0068</td>   <td>0.0011</td> \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>urban</th>               <td>-0.0052</td>   <td>0.0046</td>   <td>-1.1190</td> <td>0.2667</td>   <td>-0.0144</td>   <td>0.0040</td> \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>nonwhite</th>            <td>0.0002</td>   <td>6.955e-05</td> <td>3.4122</td>  <td>0.0010</td>  <td>9.879e-05</td>  <td>0.0004</td> \n",
       "</tr>\n",
       "</table>"
      ],
      "text/latex": [
       "\\begin{center}\n",
       "\\begin{tabular}{lclc}\n",
       "\\toprule\n",
       "\\textbf{Dep. Variable:}      &     crimerate      & \\textbf{  R-squared:         }   &      0.8707      \\\\\n",
       "\\textbf{Estimator:}          &     BetweenOLS     & \\textbf{  R-squared (Between):}  &      0.8707      \\\\\n",
       "\\textbf{No. Observations:}   &         88         & \\textbf{  R-squared (Within):}   &     -0.8240      \\\\\n",
       "\\textbf{Date:}               &  Fri, Jan 17 2025  & \\textbf{  R-squared (Overall):}  &      0.7746      \\\\\n",
       "\\textbf{Time:}               &      19:06:15      & \\textbf{  Log-likelihood     }   &      327.29      \\\\\n",
       "\\textbf{Cov. Estimator:}     &     Unadjusted     & \\textbf{                     }   &                  \\\\\n",
       "\\textbf{}                    &                    & \\textbf{  F-statistic:       }   &      46.536      \\\\\n",
       "\\textbf{Entities:}           &         88         & \\textbf{  P-value            }   &      0.0000      \\\\\n",
       "\\textbf{Avg Obs:}            &       6.3523       & \\textbf{  Distribution:      }   &     F(11,76)     \\\\\n",
       "\\textbf{Min Obs:}            &       1.0000       & \\textbf{                     }   &                  \\\\\n",
       "\\textbf{Max Obs:}            &       7.0000       & \\textbf{  F-statistic (robust):} &      46.536      \\\\\n",
       "\\textbf{}                    &                    & \\textbf{  P-value            }   &      0.0000      \\\\\n",
       "\\textbf{Time periods:}       &         7          & \\textbf{  Distribution:      }   &     F(11,76)     \\\\\n",
       "\\textbf{Avg Obs:}            &       79.857       & \\textbf{                     }   &                  \\\\\n",
       "\\textbf{Min Obs:}            &       76.000       & \\textbf{                     }   &                  \\\\\n",
       "\\textbf{Max Obs:}            &       84.000       & \\textbf{                     }   &                  \\\\\n",
       "\\textbf{}                    &                    & \\textbf{                     }   &                  \\\\\n",
       "\\bottomrule\n",
       "\\end{tabular}\n",
       "\\begin{tabular}{lcccccc}\n",
       "                             & \\textbf{Parameter} & \\textbf{Std. Err.} & \\textbf{T-stat} & \\textbf{P-value} & \\textbf{Lower CI} & \\textbf{Upper CI}  \\\\\n",
       "\\midrule\n",
       "\\textbf{const}               &       0.0417       &       0.0104       &      4.0093     &      0.0001      &       0.0210      &       0.0624       \\\\\n",
       "\\textbf{arrested}            &      -0.0652       &       0.0090       &     -7.2223     &      0.0000      &      -0.0831      &      -0.0472       \\\\\n",
       "\\textbf{convicted}           &      -0.0390       &       0.0059       &     -6.6007     &      0.0000      &      -0.0507      &      -0.0272       \\\\\n",
       "\\textbf{imprisoned}          &       0.0221       &       0.0143       &      1.5460     &      0.1263      &      -0.0064      &       0.0505       \\\\\n",
       "\\textbf{average\\_sentence}   &      -0.0004       &       0.0005       &     -0.7510     &      0.4550      &      -0.0014      &       0.0007       \\\\\n",
       "\\textbf{police\\_per\\_capita} &       3.1896       &       1.5684       &      2.0336     &      0.0455      &       0.0658      &       6.3134       \\\\\n",
       "\\textbf{population\\_density} &       0.0055       &       0.0010       &      5.2565     &      0.0000      &       0.0034      &       0.0076       \\\\\n",
       "\\textbf{taxes\\_per\\_capita}  &       0.0002       &       0.0001       &      2.0763     &      0.0413      &      8.77e-06     &       0.0004       \\\\\n",
       "\\textbf{west}                &      -0.0046       &       0.0030       &     -1.5643     &      0.1219      &      -0.0105      &       0.0013       \\\\\n",
       "\\textbf{central}             &      -0.0028       &       0.0020       &     -1.4310     &      0.1565      &      -0.0068      &       0.0011       \\\\\n",
       "\\textbf{urban}               &      -0.0052       &       0.0046       &     -1.1190     &      0.2667      &      -0.0144      &       0.0040       \\\\\n",
       "\\textbf{nonwhite}            &       0.0002       &     6.955e-05      &      3.4122     &      0.0010      &     9.879e-05     &       0.0004       \\\\\n",
       "\\bottomrule\n",
       "\\end{tabular}\n",
       "%\\caption{BetweenOLS Estimation Summary}\n",
       "\\end{center}"
      ],
      "text/plain": [
       "<class 'linearmodels.compat.statsmodels.Summary'>\n",
       "\"\"\"\n",
       "                         BetweenOLS Estimation Summary                          \n",
       "================================================================================\n",
       "Dep. Variable:              crimerate   R-squared:                        0.8707\n",
       "Estimator:                 BetweenOLS   R-squared (Between):              0.8707\n",
       "No. Observations:                  88   R-squared (Within):              -0.8240\n",
       "Date:                Fri, Jan 17 2025   R-squared (Overall):              0.7746\n",
       "Time:                        19:06:15   Log-likelihood                    327.29\n",
       "Cov. Estimator:            Unadjusted                                           \n",
       "                                        F-statistic:                      46.536\n",
       "Entities:                          88   P-value                           0.0000\n",
       "Avg Obs:                       6.3523   Distribution:                   F(11,76)\n",
       "Min Obs:                       1.0000                                           \n",
       "Max Obs:                       7.0000   F-statistic (robust):             46.536\n",
       "                                        P-value                           0.0000\n",
       "Time periods:                       7   Distribution:                   F(11,76)\n",
       "Avg Obs:                       79.857                                           \n",
       "Min Obs:                       76.000                                           \n",
       "Max Obs:                       84.000                                           \n",
       "                                                                                \n",
       "                                 Parameter Estimates                                  \n",
       "======================================================================================\n",
       "                    Parameter  Std. Err.     T-stat    P-value    Lower CI    Upper CI\n",
       "--------------------------------------------------------------------------------------\n",
       "const                  0.0417     0.0104     4.0093     0.0001      0.0210      0.0624\n",
       "arrested              -0.0652     0.0090    -7.2223     0.0000     -0.0831     -0.0472\n",
       "convicted             -0.0390     0.0059    -6.6007     0.0000     -0.0507     -0.0272\n",
       "imprisoned             0.0221     0.0143     1.5460     0.1263     -0.0064      0.0505\n",
       "average_sentence      -0.0004     0.0005    -0.7510     0.4550     -0.0014      0.0007\n",
       "police_per_capita      3.1896     1.5684     2.0336     0.0455      0.0658      6.3134\n",
       "population_density     0.0055     0.0010     5.2565     0.0000      0.0034      0.0076\n",
       "taxes_per_capita       0.0002     0.0001     2.0763     0.0413    8.77e-06      0.0004\n",
       "west                  -0.0046     0.0030    -1.5643     0.1219     -0.0105      0.0013\n",
       "central               -0.0028     0.0020    -1.4310     0.1565     -0.0068      0.0011\n",
       "urban                 -0.0052     0.0046    -1.1190     0.2667     -0.0144      0.0040\n",
       "nonwhite               0.0002  6.955e-05     3.4122     0.0010   9.879e-05      0.0004\n",
       "======================================================================================\n",
       "\"\"\""
      ]
     },
     "execution_count": 29,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Модель с фиксированными эффектами (метод внутригруппового преобразования)\n",
    "mod_fe = BetweenOLS(y, X)\n",
    "res_fe = mod_fe.fit()\n",
    "res_fe.summary"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 30,
   "id": "df19eaa8",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/html": [
       "<table class=\"simpletable\">\n",
       "<caption>RandomEffects Estimation Summary</caption>\n",
       "<tr>\n",
       "  <th>Dep. Variable:</th>        <td>crimerate</td>    <th>  R-squared:         </th>    <td>0.4817</td>  \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Estimator:</th>          <td>RandomEffects</td>  <th>  R-squared (Between):</th>   <td>0.8190</td>  \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>No. Observations:</th>        <td>559</td>       <th>  R-squared (Within):</th>    <td>0.1733</td>  \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Date:</th>             <td>Fri, Jan 17 2025</td> <th>  R-squared (Overall):</th>   <td>0.7881</td>  \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Time:</th>                 <td>19:06:16</td>     <th>  Log-likelihood     </th>    <td>2273.6</td>  \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Cov. Estimator:</th>      <td>Unadjusted</td>    <th>                     </th>       <td></td>     \n",
       "</tr>\n",
       "<tr>\n",
       "  <th></th>                          <td></td>         <th>  F-statistic:       </th>    <td>46.220</td>  \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Entities:</th>                <td>88</td>        <th>  P-value            </th>    <td>0.0000</td>  \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Avg Obs:</th>               <td>6.3523</td>      <th>  Distribution:      </th>   <td>F(11,547)</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Min Obs:</th>               <td>1.0000</td>      <th>                     </th>       <td></td>     \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Max Obs:</th>               <td>7.0000</td>      <th>  F-statistic (robust):</th>  <td>50.081</td>  \n",
       "</tr>\n",
       "<tr>\n",
       "  <th></th>                          <td></td>         <th>  P-value            </th>    <td>0.0000</td>  \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Time periods:</th>             <td>7</td>        <th>  Distribution:      </th>   <td>F(11,547)</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Avg Obs:</th>               <td>79.857</td>      <th>                     </th>       <td></td>     \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Min Obs:</th>               <td>76.000</td>      <th>                     </th>       <td></td>     \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>Max Obs:</th>               <td>84.000</td>      <th>                     </th>       <td></td>     \n",
       "</tr>\n",
       "<tr>\n",
       "  <th></th>                          <td></td>         <th>                     </th>       <td></td>     \n",
       "</tr>\n",
       "</table>\n",
       "<table class=\"simpletable\">\n",
       "<caption>Parameter Estimates</caption>\n",
       "<tr>\n",
       "           <td></td>          <th>Parameter</th> <th>Std. Err.</th> <th>T-stat</th>  <th>P-value</th>  <th>Lower CI</th>  <th>Upper CI</th> \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>const</th>               <td>0.0348</td>    <td>0.0039</td>   <td>8.9516</td>  <td>0.0000</td>    <td>0.0272</td>    <td>0.0424</td>  \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>arrested</th>            <td>-0.0289</td>   <td>0.0033</td>   <td>-8.8665</td> <td>0.0000</td>    <td>-0.0353</td>   <td>-0.0225</td> \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>convicted</th>           <td>-0.0166</td>   <td>0.0017</td>   <td>-9.9848</td> <td>0.0000</td>    <td>-0.0199</td>   <td>-0.0133</td> \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>imprisoned</th>          <td>-0.0094</td>   <td>0.0028</td>   <td>-3.3637</td> <td>0.0008</td>    <td>-0.0149</td>   <td>-0.0039</td> \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>average_sentence</th>    <td>0.0002</td>   <td>8.694e-05</td> <td>2.0932</td>  <td>0.0368</td>   <td>1.121e-05</td>  <td>0.0004</td>  \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>police_per_capita</th>   <td>3.6508</td>    <td>0.8661</td>   <td>4.2150</td>  <td>0.0000</td>    <td>1.9494</td>    <td>5.3522</td>  \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>population_density</th>  <td>0.0071</td>    <td>0.0009</td>   <td>8.0472</td>  <td>0.0000</td>    <td>0.0054</td>    <td>0.0088</td>  \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>taxes_per_capita</th>   <td>2.989e-05</td> <td>2.474e-05</td> <td>1.2082</td>  <td>0.2275</td>  <td>-1.871e-05</td> <td>7.849e-05</td>\n",
       "</tr>\n",
       "<tr>\n",
       "  <th>west</th>                <td>-0.0088</td>   <td>0.0028</td>   <td>-3.1942</td> <td>0.0015</td>    <td>-0.0143</td>   <td>-0.0034</td> \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>central</th>             <td>-0.0046</td>   <td>0.0019</td>   <td>-2.4119</td> <td>0.0162</td>    <td>-0.0083</td>   <td>-0.0009</td> \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>urban</th>               <td>-0.0020</td>   <td>0.0042</td>   <td>-0.4746</td> <td>0.6352</td>    <td>-0.0102</td>   <td>0.0062</td>  \n",
       "</tr>\n",
       "<tr>\n",
       "  <th>nonwhite</th>            <td>0.0001</td>   <td>6.489e-05</td> <td>2.2416</td>  <td>0.0254</td>   <td>1.799e-05</td>  <td>0.0003</td>  \n",
       "</tr>\n",
       "</table>"
      ],
      "text/latex": [
       "\\begin{center}\n",
       "\\begin{tabular}{lclc}\n",
       "\\toprule\n",
       "\\textbf{Dep. Variable:}      &     crimerate      & \\textbf{  R-squared:         }   &      0.4817      \\\\\n",
       "\\textbf{Estimator:}          &   RandomEffects    & \\textbf{  R-squared (Between):}  &      0.8190      \\\\\n",
       "\\textbf{No. Observations:}   &        559         & \\textbf{  R-squared (Within):}   &      0.1733      \\\\\n",
       "\\textbf{Date:}               &  Fri, Jan 17 2025  & \\textbf{  R-squared (Overall):}  &      0.7881      \\\\\n",
       "\\textbf{Time:}               &      19:06:16      & \\textbf{  Log-likelihood     }   &      2273.6      \\\\\n",
       "\\textbf{Cov. Estimator:}     &     Unadjusted     & \\textbf{                     }   &                  \\\\\n",
       "\\textbf{}                    &                    & \\textbf{  F-statistic:       }   &      46.220      \\\\\n",
       "\\textbf{Entities:}           &         88         & \\textbf{  P-value            }   &      0.0000      \\\\\n",
       "\\textbf{Avg Obs:}            &       6.3523       & \\textbf{  Distribution:      }   &    F(11,547)     \\\\\n",
       "\\textbf{Min Obs:}            &       1.0000       & \\textbf{                     }   &                  \\\\\n",
       "\\textbf{Max Obs:}            &       7.0000       & \\textbf{  F-statistic (robust):} &      50.081      \\\\\n",
       "\\textbf{}                    &                    & \\textbf{  P-value            }   &      0.0000      \\\\\n",
       "\\textbf{Time periods:}       &         7          & \\textbf{  Distribution:      }   &    F(11,547)     \\\\\n",
       "\\textbf{Avg Obs:}            &       79.857       & \\textbf{                     }   &                  \\\\\n",
       "\\textbf{Min Obs:}            &       76.000       & \\textbf{                     }   &                  \\\\\n",
       "\\textbf{Max Obs:}            &       84.000       & \\textbf{                     }   &                  \\\\\n",
       "\\textbf{}                    &                    & \\textbf{                     }   &                  \\\\\n",
       "\\bottomrule\n",
       "\\end{tabular}\n",
       "\\begin{tabular}{lcccccc}\n",
       "                             & \\textbf{Parameter} & \\textbf{Std. Err.} & \\textbf{T-stat} & \\textbf{P-value} & \\textbf{Lower CI} & \\textbf{Upper CI}  \\\\\n",
       "\\midrule\n",
       "\\textbf{const}               &       0.0348       &       0.0039       &      8.9516     &      0.0000      &       0.0272      &       0.0424       \\\\\n",
       "\\textbf{arrested}            &      -0.0289       &       0.0033       &     -8.8665     &      0.0000      &      -0.0353      &      -0.0225       \\\\\n",
       "\\textbf{convicted}           &      -0.0166       &       0.0017       &     -9.9848     &      0.0000      &      -0.0199      &      -0.0133       \\\\\n",
       "\\textbf{imprisoned}          &      -0.0094       &       0.0028       &     -3.3637     &      0.0008      &      -0.0149      &      -0.0039       \\\\\n",
       "\\textbf{average\\_sentence}   &       0.0002       &     8.694e-05      &      2.0932     &      0.0368      &     1.121e-05     &       0.0004       \\\\\n",
       "\\textbf{police\\_per\\_capita} &       3.6508       &       0.8661       &      4.2150     &      0.0000      &       1.9494      &       5.3522       \\\\\n",
       "\\textbf{population\\_density} &       0.0071       &       0.0009       &      8.0472     &      0.0000      &       0.0054      &       0.0088       \\\\\n",
       "\\textbf{taxes\\_per\\_capita}  &     2.989e-05      &     2.474e-05      &      1.2082     &      0.2275      &     -1.871e-05    &     7.849e-05      \\\\\n",
       "\\textbf{west}                &      -0.0088       &       0.0028       &     -3.1942     &      0.0015      &      -0.0143      &      -0.0034       \\\\\n",
       "\\textbf{central}             &      -0.0046       &       0.0019       &     -2.4119     &      0.0162      &      -0.0083      &      -0.0009       \\\\\n",
       "\\textbf{urban}               &      -0.0020       &       0.0042       &     -0.4746     &      0.6352      &      -0.0102      &       0.0062       \\\\\n",
       "\\textbf{nonwhite}            &       0.0001       &     6.489e-05      &      2.2416     &      0.0254      &     1.799e-05     &       0.0003       \\\\\n",
       "\\bottomrule\n",
       "\\end{tabular}\n",
       "%\\caption{RandomEffects Estimation Summary}\n",
       "\\end{center}"
      ],
      "text/plain": [
       "<class 'linearmodels.compat.statsmodels.Summary'>\n",
       "\"\"\"\n",
       "                        RandomEffects Estimation Summary                        \n",
       "================================================================================\n",
       "Dep. Variable:              crimerate   R-squared:                        0.4817\n",
       "Estimator:              RandomEffects   R-squared (Between):              0.8190\n",
       "No. Observations:                 559   R-squared (Within):               0.1733\n",
       "Date:                Fri, Jan 17 2025   R-squared (Overall):              0.7881\n",
       "Time:                        19:06:16   Log-likelihood                    2273.6\n",
       "Cov. Estimator:            Unadjusted                                           \n",
       "                                        F-statistic:                      46.220\n",
       "Entities:                          88   P-value                           0.0000\n",
       "Avg Obs:                       6.3523   Distribution:                  F(11,547)\n",
       "Min Obs:                       1.0000                                           \n",
       "Max Obs:                       7.0000   F-statistic (robust):             50.081\n",
       "                                        P-value                           0.0000\n",
       "Time periods:                       7   Distribution:                  F(11,547)\n",
       "Avg Obs:                       79.857                                           \n",
       "Min Obs:                       76.000                                           \n",
       "Max Obs:                       84.000                                           \n",
       "                                                                                \n",
       "                                 Parameter Estimates                                  \n",
       "======================================================================================\n",
       "                    Parameter  Std. Err.     T-stat    P-value    Lower CI    Upper CI\n",
       "--------------------------------------------------------------------------------------\n",
       "const                  0.0348     0.0039     8.9516     0.0000      0.0272      0.0424\n",
       "arrested              -0.0289     0.0033    -8.8665     0.0000     -0.0353     -0.0225\n",
       "convicted             -0.0166     0.0017    -9.9848     0.0000     -0.0199     -0.0133\n",
       "imprisoned            -0.0094     0.0028    -3.3637     0.0008     -0.0149     -0.0039\n",
       "average_sentence       0.0002  8.694e-05     2.0932     0.0368   1.121e-05      0.0004\n",
       "police_per_capita      3.6508     0.8661     4.2150     0.0000      1.9494      5.3522\n",
       "population_density     0.0071     0.0009     8.0472     0.0000      0.0054      0.0088\n",
       "taxes_per_capita    2.989e-05  2.474e-05     1.2082     0.2275  -1.871e-05   7.849e-05\n",
       "west                  -0.0088     0.0028    -3.1942     0.0015     -0.0143     -0.0034\n",
       "central               -0.0046     0.0019    -2.4119     0.0162     -0.0083     -0.0009\n",
       "urban                 -0.0020     0.0042    -0.4746     0.6352     -0.0102      0.0062\n",
       "nonwhite               0.0001  6.489e-05     2.2416     0.0254   1.799e-05      0.0003\n",
       "======================================================================================\n",
       "\"\"\""
      ]
     },
     "execution_count": 30,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "# Модель со случайными эффектами\n",
    "mod_re = RandomEffects(y, X)\n",
    "res_re = mod_re.fit()\n",
    "res_re.summary"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 45,
   "id": "3636b4bc",
   "metadata": {},
   "outputs": [
    {
     "data": {
      "text/plain": [
       "(50.107410044715486, 1.3377001468108886e-06)"
      ]
     },
     "execution_count": 45,
     "metadata": {},
     "output_type": "execute_result"
    }
   ],
   "source": [
    "#Тест Хаусмана\n",
    "def hausman(fe, re):\n",
    "    b_fe = fe.params\n",
    "    b_re = re.params\n",
    "    diff = b_fe - b_re\n",
    "\n",
    "    cov_fe = fe.cov\n",
    "    cov_re = re.cov\n",
    "\n",
    "    cov_diff = cov_fe - cov_re\n",
    "\n",
    "    stat = np.dot(np.dot(diff.T, np.linalg.inv(cov_diff)), diff)\n",
    "    pvalue = stats.chi2.sf(stat, len(diff))\n",
    "    return stat, pvalue\n",
    "\n",
    "hausman(res_fe, res_re)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "id": "450ccb6a",
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "Python 3 (ipykernel)",
   "language": "python",
   "name": "python3"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.11.7"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 5
}
